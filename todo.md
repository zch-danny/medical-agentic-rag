# 待更新 & 待优化

## 高优先级

### 模型部署
- [ ] 部署 Qwen3-Embedding-8B 模型
- [ ] 部署 Qwen3-Reranker-8B 模型
- [ ] 配置 LLM API Key（DeepSeek/OpenAI）

### 基础设施
- [ ] 部署 Milvus 服务（已有 docker-compose）
- [ ] 安装 MinerU PDF 解析工具
- [ ] 准备 GPU 服务器（推荐 RTX 4090 24GB 或 A100）

### 系统健壮性
- [ ] 文件状态持久化（当前重启后丢失）
  - 方案：SQLite + SQLAlchemy
  - 表结构：documents(id, filename, status, chunk_count, created_at)
- [ ] API 认证（Token / API Key）
  - JWT 或简单 API Key 方案
- [ ] 增量索引
  - 只索引新增/修改的文档
  - 基于文件哈希判断是否需要重新索引

## 中优先级

### 核心功能增强
- [ ] 多轮对话 & 上下文记忆
  - 支持追问（如"第二种怎么治疗？"）
  - 会话历史存储
- [ ] 答案溯源 & 引用高亮
  - 返回答案时标注来源文献和段落
  - 支持前端高亮显示引用片段
- [ ] 文档去重
  - 检测重复上传的 PDF
  - 基于内容哈希或语义相似度

### 医疗领域特色
- [ ] 医疗同义词词典（查询扩展）
  - 常见缩写映射：DM<->糖尿病、HTN<->高血压
  - 中英文对照：阿司匹林<->aspirin
- [ ] ICD-10 编码词典
  - 支持 ICD 编码检索：E11.9 -> 2型糖尿病
- [ ] jieba 医学词典
  - 添加医学专有名词，提升 BM25 分词效果
- [ ] 结构化信息提取
  - 从文献中提取：疾病、症状、治疗方案、禁忌症
  - 输出 JSON 格式供下游使用

### 性能优化
- [ ] 模型量化（INT8/INT4）降低显存需求
- [ ] Embedding 批处理优化
- [ ] 异步任务队列（Celery / RQ）
  - 大文件上传 -> 后台解析
  - 批量索引 -> 后台执行
- [ ] 模型降级策略
  - GPU 不可用时自动切换到 API 模式
  - Reranker 超时时跳过重排序

### API 增强
- [ ] 上传文件大小限制
- [ ] 请求速率限制
- [ ] 检索历史记录
  - 表结构：search_history(id, user_id, query, timestamp, result_count)
- [ ] 用户反馈机制
  - 标记"有用/无用"
  - 用于后续优化检索参数

## 低优先级

### 可选功能
- [ ] PubMed API 集成
  - 本地文献不足时联网补充
  - 免费，需注册 API Key
- [ ] 前端界面（Gradio / Streamlit）
  - 给非技术用户使用
- [ ] 用药知识库集成
  - 药物相互作用查询（集成 DrugBank）
  - 禁忌症提示
- [ ] 临床指南版本管理
  - 同一指南不同年份版本对比
  - 标注"最新版本"

### 用户体验
- [ ] 收藏/书签功能
  - 表结构：bookmarks(id, user_id, document_id, chunk_id, note)
- [ ] 报告导出
  - 将检索结果 + AI 答案导出为 PDF/Word
  - 包含引用文献列表
- [ ] 文档预览
  - 在线查看 PDF 内容

### 部署优化
- [ ] Docker 镜像构建优化
- [ ] Kubernetes 部署配置
- [ ] 监控告警（Prometheus + Grafana）
- [ ] 日志聚合（ELK）
- [ ] 审计日志
  - 记录谁在什么时间查询了什么
  - 敏感操作记录（删除文档、修改配置）

### 评估与测试
- [ ] 构建医疗领域测试集
- [ ] 检索效果评估（MRR、NDCG、Recall）
- [ ] A/B 测试不同 alpha 参数

## 已知问题

### 待修复
- [ ] Docker healthcheck 依赖 curl（Milvus 镜像可能没有）
- [ ] jieba 的 pkg_resources 弃用警告（不影响功能）

### 限制
- 文件注册表重启后清空（内存存储）-> 待持久化解决
- 不支持 PDF 以外的文件格式
- 单机部署，不支持分布式
- 不支持多轮对话

## 技术债务

- [ ] 代码架构重构（模块化单体）
  - api/ -> 接口层
  - core/ -> 核心业务逻辑
  - infrastructure/ -> 基础设施层
- [ ] 依赖注入改造
  - 避免全局状态
  - 使用 FastAPI Depends
- [ ] 添加更多单元测试
- [ ] 添加集成测试
- [ ] 代码注释完善
- [ ] 类型标注检查（mypy）

---

## 版本规划

### v1.0（当前）
- [x] 基础 RAG 流程
- [x] REST API
- [x] 文件上传
- [x] 元数据提取（标题/年份/DOI/关键词）

### v1.1（计划）
- 文件状态持久化（SQLite）
- API 认证
- 增量索引
- 医疗同义词支持

### v1.2（计划）
- 多轮对话支持
- 答案溯源
- 异步任务队列
- 检索历史

### v2.0（远期）
- 前端界面
- PubMed 联网
- 结构化信息提取
- 代码架构重构

### v3.0（远期）
- 分布式部署
- 药物相互作用检查
- 临床决策支持
