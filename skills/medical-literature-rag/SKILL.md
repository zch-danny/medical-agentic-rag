---
name: medical-literature-rag
description: 医疗文献语义检索与智能问答。当用户询问医学诊断、治疗方案、药物使用、临床症状、疾病预后等问题时使用此 Skill。
---

# 医疗文献检索与问答 Skill

## 概述

本 Skill 用于从医疗文献库中检索相关信息并生成专业、准确的医学问答。基于 Qwen3-Embedding + Milvus 混合检索 + Qwen3-Reranker 重排序的 RAG 架构。

## 工作流程

### 1. 查询理解与改写

将用户的自然语言问题转换为更适合检索的专业医学术语查询。

**改写策略**：
- 识别核心医学概念（疾病、症状、药物、治疗方法）
- 扩展同义词和缩写（参考 [MEDICAL_TERMS.md](MEDICAL_TERMS.md)）
- 生成 2-3 个语义等价但表述不同的查询

**示例**：
```
用户输入: "血压高吃什么药好"
改写查询:
  1. 高血压一线降压药物治疗方案
  2. HTN 常用降压药选择指南
  3. 原发性高血压药物治疗推荐
```

### 2. 检索文献

调用检索服务获取相关文献片段：

```bash
# 使用检索脚本
python scripts/search.py --query "改写后的查询" --top-k 10
```

或通过 Python API：

```python
from src.retriever import MedicalRetriever
from config import settings

retriever = MedicalRetriever(settings)
results = retriever.search(query, top_k=10, use_rerank=True)
```

### 3. 生成回答

基于检索到的文献片段生成回答，遵循以下原则：

#### 回答结构

```
[简明回答]
直接回答用户问题的核心内容（1-2句话）

[详细解释]
- 要点1（引用来源 [1]）
- 要点2（引用来源 [2]）
- ...

[证据等级说明]（可选）
- 强证据：临床指南、Meta分析
- 中等证据：RCT研究
- 弱证据：观察性研究、专家意见

[注意事项]
用药/诊断相关的风险提示
```

#### 引用规范

- 每个关键陈述必须标注来源：`[1]`、`[2]` 等
- 引用格式：`[编号] 来源文件名`
- 多个来源支持同一观点时：`[1,2]`

#### 禁止事项

❌ 不要编造未在检索结果中出现的信息
❌ 不要给出具体药物剂量（除非文献明确记载）
❌ 不要做出确定性的诊断结论
❌ 不要替代专业医疗建议

### 4. 回答示例

**用户问题**: 2型糖尿病的一线治疗药物是什么？

**回答**:

2型糖尿病的一线治疗药物是**二甲双胍**（Metformin）[1]。

**详细说明**：
- 二甲双胍作为一线用药已被国内外多部指南推荐，适用于无禁忌证的2型糖尿病患者 [1,2]
- 起始剂量通常为 500mg，随餐服用，可逐渐增加至最大耐受剂量 [1]
- 主要通过抑制肝脏糖异生、改善胰岛素敏感性发挥作用 [2]
- 常见不良反应为胃肠道症状，多为一过性 [1]

**注意**：肾功能不全（eGFR<30）、严重肝功能损害、急性心衰等情况下禁用。具体用药请遵医嘱。

**参考文献**：
[1] 中国2型糖尿病防治指南.pdf
[2] 内分泌学教材.pdf

---

## 医学术语参考

常见医学缩写和同义词，用于查询改写：

| 常用词 | 专业术语 / 缩写 | 英文 |
|--------|----------------|------|
| 糖尿病 | 消渴症、DM | diabetes mellitus |
| 高血压 | HTN | hypertension |
| 心梗 | 心肌梗死、MI | myocardial infarction |
| 中风 | 脑卒中、CVA | cerebrovascular accident |
| 肺炎 | 肺部感染 | pneumonia |
| 心衰 | 心力衰竭、CHF | congestive heart failure |
| 冠心病 | CAD | coronary artery disease |
| 慢阻肺 | COPD | chronic obstructive pulmonary disease |
| 肾衰 | CKD、慢性肾脏病 | chronic kidney disease |

完整术语表参见 [MEDICAL_TERMS.md](MEDICAL_TERMS.md)

---

## 检索参数调优指南

| 参数 | 默认值 | 调整建议 |
|------|--------|----------|
| `top_k` | 10 | 问题复杂时增至 20-50 |
| `use_rerank` | true | 追求速度时可关闭 |
| `hybrid_alpha` | 0.7 | 短查询（<4字）降至 0.5 |

---

## 错误处理

| 场景 | 处理方式 |
|------|----------|
| 检索无结果 | 告知用户"未找到相关文献"，建议换词检索 |
| 信息不足 | 明确说明"现有文献未覆盖此问题" |
| 检索超时 | 返回向量检索结果（降级），标注"结果可能不完整" |
| 矛盾信息 | 列出不同观点及来源，说明证据等级差异 |

---

## 免责声明

本系统提供的信息仅供参考，不能替代专业医疗诊断和治疗建议。如有健康问题，请咨询执业医师。
